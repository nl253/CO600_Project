"use strict";function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}/**
 * Select (highlight) a list item.
 *
 * @param {'Module'|'Lesson'|'Question'} what
 * @param {!Number} id
 */function select(a,b){return document.querySelector("#module-edit-list-".concat(a.toLowerCase()," li[data-id='").concat(b,"']")).classList.add("has-background-light")}/**
 * Un-Select (un-highlights) a list item.
 *
 * @param {'Module'|'Lesson'|'Question'} what
 */function unSelect(a){var b=document.querySelector("#module-edit-list-".concat(a.toLowerCase()," li[class*=has-background-light]"));b&&b.classList.remove("has-background-light")}/**
 * Saves the last click. (this is recalled later)
 *
 * @param {'Module'|'Lesson'|'Question'} what
 * @param {!Number} id
 */function saveClick(a,b){return sessionStorage.setItem("".concat(location.pathname,"?click"),JSON.stringify({page:a.toLowerCase(),id:b}))}/**
 * Clears a list.
 *
 * @param {'Module'|'Lesson'|'Question'} what
 */function clearList(a){return document.getElementById("module-edit-list-".concat(a.toLowerCase())).innerHTML=""}/**
 * Clears the edit pane.
 */function clearPane(){return document.getElementById("module-edit-pane").innerHTML=""}/**
 * Gets the id of selected.
 *
 * @param {'Module'|'Lesson'|'Question'} what
 * @return {?Number}
 */function getSelId(what){var maybe=document.querySelector("#module-edit-list-".concat(what.toLowerCase()," li[class*=has-background-light]"));return maybe?eval(maybe.getAttribute("data-id")):null}/**
 * Shows the lesson edit pane.
 *
 * @param {!{id: !Number, name: ?String, authorId: !Number, topic: ?String, summary: ?String}} module
 * @param {!Array<!String>} topics
 * @return {Promise<void>}
 */function showModEditPane(){return _showModEditPane.apply(this,arguments)}/**
 * Shows the lesson edit pane.
 *
 * @param {{id: !Number, moduleId: !Number, name: ?String, content: ?Boolean, summary: ?String}} lesson
 * @param {Array<{id: ?Number, name: !String}>} attachments
 */function _showModEditPane(){return _showModEditPane=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var c,d=arguments;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=1<d.length&&void 0!==d[1]?d[1]:["AI","Anthropology","Archeology","Architecture","Arts","Biology","Chemistry","Computer Science","Design","Drama","Economics","Engineering","Geography","History","Humanities","Languages","Law","Linguistics","Literature","Mathematics","Medicine","Philosophy","Physics","Political Science","Psychology","Sciences","Social Sciences","Sociology","Theology"],a.prev=1,a.t1="\n      <h2 class=\"title\" style=\"margin-bottom: 10px;\">\n        Name\n      </h2>\n      \n      <div id=\"module-edit-name\" \n           contenteditable=\"true\" \n           style=\"border-radius: 18px; border: none; padding-top: 5px; padding-bottom: 5px; padding-left: 10px; font-size: 1.2rem;\" class=\"has-background-light\">\n        ".concat(b.name?b.name:"","\n      </div>\n      <h3 class=\"subtitle\" style=\"margin: 25px 0 0 0;\">\n        Topic\n      </h3>\n      <div class=\"dropdown\" \n           onmouseover=\"this.classList.add('is-active')\"\n           onmouseout=\"this.classList.remove('is-active')\">\n        <div class=\"dropdown-trigger\">\n          <button class=\"button has-background-light\" aria-haspopup=\"true\" aria-controls=\"dropdown-menu\" style=\"border: none;\">\n            <span id=\"module-edit-topic\" style=\"min-width: 150px;\">").concat(b.topic?b.topic:"","</span>\n            <span class=\"icon is-small\">\n              <i class=\"fas fa-angle-down\" aria-hidden=\"true\"></i>\n            </span>\n          </button>\n        </div>\n        <div class=\"dropdown-menu\" id=\"dropdown-menu\" role=\"menu\" style=\"margin-bottom: 30px;\">\n          <div class=\"dropdown-content\">\n            ").concat(c.map(function(a){return"<a class='dropdown-item' onclick='document.getElementById(\"module-edit-topic\").innerText = this.innerText.trim()'>"+a+"</a>"}),"\n            <hr class=\"dropdown-divider\">\n            <span class=\"dropdown-item\" style=\"font-weight: bold;\">\n              Other\n            </span>\n            <a class=\"dropdown-item\" \n               onmouseout=\"document.getElementById('module-edit-topic').innerText = this.innerText.trim()\" \n               id=\"module-edit-topic-other\" \n               contenteditable=\"true\"\n               style=\"margin: 5px 10px; max-width: 90%;\">\n              ").concat(b.topic?b.topic:"","\n            </a>\n          </div>\n        </div>\n      </div>\n      <section class=\"content\" style=\"margin-top: 40px;\">\n        <strong>Author</strong>   \n        <a href=\"/user/").concat(b.authorId,"\">\n          "),a.next=5,get("User",{id:b.authorId}).then(function(a){return a[0].email});case 5:return a.t2=a.sent,a.t0=a.t1.concat.call(a.t1,a.t2,"\n        </a>\n        <br>\n        <strong>Rating</strong> <span id=\"module-edit-rating\">"),a.next=9,get("Rating",{moduleId:b.id}).then(function(a){return a.map(function(a){return a.stars})}).then(function(a){var b=a.length;return 0<b?a.reduce(function(a,b){return a+b})/b:0});case 9:a.t3=a.sent,a.t4=b.summary?b.summary:"",a.t5=b.id,document.getElementById("module-edit-pane").innerHTML=a.t0.concat.call(a.t0,a.t3,"/5</span>\n      </section>\n      <section class=\"is-medium\" style=\"margin-bottom: 30px;\">\n        <h2 class=\"title is-medium\" style=\"margin-bottom: 10px;\">Summary</h2>\n        <textarea id=\"module-edit-summary\"\n                  style=\"word-wrap: break-word;\">").concat(a.t4,"</textarea>\n      </section>\n      <div class=\"columns is-center is-multiline is-narrow\" style=\"max-width: 400px; margin-left: auto; margin-right: auto;\">\n        <div class=\"is-block column is-4-fullhd is-4-desktop is-4-tablet is-12-mobile\">\n          <button type=\"reset\" onclick=\"alert('Not Implemented Yet.')\" class=\"button is-warning is-block\" style=\"margin: 7px auto; width: 100%;\">\n            <i class=\"fas fa-undo\" style=\"position: relative; top: 4px; left: 2px;\"></i>\n            <span>Reset</span>\n          </button>\n        </div>\n        <div class=\"is-block column is-4-fullhd is-4-desktop is-4-tablet is-12-mobile\">\n          <button type=\"submit\" onclick=\"updateMod()\" class=\"button is-success is-block\" style=\"margin: 7px auto; width: 100%;\">\n            <i class=\"fas fa-check\" style=\"position: relative; top: 4px; left: 2px;\"></i>\n            <span>Save</span>\n          </button>\n        </div>\n        <div class=\"is-block column is-4-fullhd is-4-desktop is-4-tablet is-12-mobile\">\n          <button onclick=\"if (confirm('Delete module?')) destroyMod(").concat(a.t5,")\" class=\"button is-danger is-block\" style=\"margin: 7px auto; width: 100%;\">\n            <i class=\"fas fa-times\" style=\"position: relative; top: 4px; left: 2px;\"></i>\n            <span>Delete</span>\n          </button>\n        </div>\n      </div>\n    "),a.next=19;break;case 15:return a.prev=15,a.t6=a["catch"](1),console.error(a.t6),a.abrupt("return",alert(a.t6.msg||a.t6.message||a.t6.toString()));case 19:case"end":return a.stop();}},a,this,[[1,15]])})),_showModEditPane.apply(this,arguments)}function showLessEditPane(){return _showLessEditPane.apply(this,arguments)}/**
 * Shows the question edit pane.
 *
 * @param {{id: !Number, moduleId: !Number, correctAnswer: ?String, badAnswer1: ?String, badAnswer2: ?String, badAnswer3: ?String}} question
 */function _showLessEditPane(){return _showLessEditPane=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var c,d=arguments;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=1<d.length&&void 0!==d[1]?d[1]:[],document.getElementById("module-edit-pane").innerHTML="\n    <form enctype=\"multipart/form-data\"\n          id=\"module-edit-form-lesson\"\n          disabled=\"true\"\n          class=\"lesson-edit-form column is-10-desktop is-full-tablet is-full-mobile\"\n          style=\"display: flex; flex-direction: column; justify-content: space-around; align-items: flex-start; margin-top: -15px;\">\n      <h2 class=\"title is-3\">Name</h2>\n      <input name=\"name\" value=\"".concat(b.name?b.name:"","\" \n             class=\"has-background-light\"\n             autocomplete=\"on\" placeholder=\"e.g. Introduction to AI\"\n             style=\"padding: 5px 10px; border: none; border-radius: 18px; font-size: 1.2rem;\">\n      <h2 class=\"title is-3\" style=\"margin-top: 20px;\">Summary</h2>\n      <textarea name=\"summary\" autocomplete=\"on\"\n                class=\"has-background-light\"\n                style=\"padding: 5px; min-height: 50px; max-height: 400px; border: none; border-radius: 18px;\">").concat(b.summary?b.summary:"","</textarea>\n      <h2 class=\"title is-3\" style=\"margin-top: 20px;\">Content</h2>\n      <p style=\"margin-bottom: 10px;\">Upload HTML file with the lesson content</p>\n      <div id=\"module-edit-lesson-content\"></div>\n      <input type=\"file\" name=\"lesson\" class=\"is-paddingless\" style=\"margin-top: 20px;\">\n      <h2 class=\"title is-3\" style=\"margin-top: 20px;\">Attachments (optional)</h2>\n      <p><strong>Select a file:</strong></p>\n      <br>\n      <ul style=\"list-style-type: disc; display: flex; flex-direction: column; justify-content: space-around; align-items: flex-start; margin-left: 19px;\">\n        <li>Image (.jpg, .jpeg, .png, .gif)</li>\n        <li>Audio (.mp3)</li>\n        <li>Video (.mp4, .mpg)</li>\n      </ul>\n      <br>\n      <input type=\"file\" name=\"attachments\" class=\"is-paddingless\" multiple style=\"display: block\">\n      <div style=\"display: flex; flex-direction: column; justify-content: space-around; align-items: flex-start; margin-top: 20px; width: 100%;\">\n        <h3 id=\"lesson-edit-h-uploaded-files title is-5\" style=\"margin-bottom: 8px;\">\n          Uploaded Files\n        </h3>\n        <ul id=\"module-edit-list-attachments\" style=\"display: flex; flex-direction: column; justify-content: flex-start; align-items: flex-start; width: 100%;\"></ul>\n      </div>\n      <div class=\"columns is-center is-multiline is-narrow\" style=\"max-width: 400px; margin-left: auto; margin-right: auto;\">\n        <div class=\"is-block column is-4-fullhd is-4-desktop is-4-tablet is-12-mobile\">\n          <button onclick=\"alert('Not Implemented Yet.')\" type=\"reset\" class=\"button is-block is-warning\" style=\"margin: 7px auto; width: 100%;\">\n            <i class=\"fas fa-undo\" style=\"position: relative; top: 4px; left: 2px;\"></i>\n            <span>Reset</span>\n          </button>\n        </div>\n        <div class=\"is-block column is-4-fullhd is-4-desktop is-4-tablet is-12-mobile\">\n          <button onclick=\"event.preventDefault(); updateLess()\" class=\"button is-block is-success\" style=\"margin: 7px auto; width: 100%;\">\n            <i class=\"fas fa-check\" style=\"position: relative; top: 4px; left: 2px;\"></i>\n            <span>Save</span>\n          </button>\n        </div>\n        <div class=\"is-block column is-4-fullhd is-4-desktop is-4-tablet is-12-mobile\">\n          <button onclick=\"event.preventDefault(); if (confirm('Delete lesson?')) destroyLess(").concat(b.id,")\" class=\"button is-block is-danger\" style=\"margin: 7px auto; width: 100%;\">\n            <i class=\"fas fa-times\" style=\"position: relative; top: 4px; left: 2px;\"></i>\n            <span>Delete</span>\n          </button>\n        </div>\n      </div>\n    </form>\n    "),b.content?setLessContent():unsetLessContent(),a.next=5,Promise.all(c.map(function(a){return appendAttachment({id:a.id,lessonId:b.id,name:a.name})}));case 5:return a.abrupt("return",a.sent);case 6:case"end":return a.stop();}},a,this)})),_showLessEditPane.apply(this,arguments)}function showQuestEditPane(a){document.getElementById("module-edit-pane").innerHTML="\n    <h1 class=\"title is-3\" style=\"margin-bottom: 10px;\">Question</h1>\n    <p><strong>Note:</strong> Save the current question before editing another one</p>\n    <br>\n    <a id=\"module-edit-question-name\" class=\"button is-light has-background-light is-block has-text-left\" contenteditable=\"true\" style=\"padding: 3px 15px\">\n      ".concat(a.name?a.name:"","\n    </a>\n    <br>\n\n    <h2 class=\"title is-3\" style=\"margin-bottom: 10px;\">Correct Answer</h2>\n    <a id=\"module-edit-question-answer\" class=\"button is-light is-block has-text-left\" contenteditable=\"true\" style=\"padding: 3px 15px;\">\n      ").concat(a.correctAnswer?a.correctAnswer:"","\n    </a>\n    \n    <h3 class=\"title is-3\" style=\"margin: 30px 0 10px 0;\">Other Answers</h3>\n\n    <p><strong>Note:</strong> Include other answers which are wrong</p>\n\n    <br>\n\n    <a id=\"module-edit-question-bad-answer-1\" class=\"button is-light has-text-left\" contenteditable=\"true\" style=\"width: 100%; padding: 3px 15px; margin-bottom: 20px;\">\n      ").concat(a.badAnswer1?a.badAnswer1:"","\n    </a>\n\n    <a id=\"module-edit-question-bad-answer-2\" class=\"button is-light has-text-left\" contenteditable=\"true\" style=\"width: 100%; padding: 3px 15px; margin-bottom: 20px;\">\n      ").concat(a.badAnswer2?a.badAnswer2:"","\n    </a>\n    \n    <a id=\"module-edit-question-bad-answer-3\" class=\"button is-light has-text-left\" contenteditable=\"true\" style=\"width: 100%; padding: 3px 15px; margin-bottom: 20px;\">\n      ").concat(a.badAnswer3?a.badAnswer3:"","\n    </a>\n    \n    <div class=\"columns is-center is-multiline is-narrow\" style=\"max-width: 400px; margin-left: auto; margin-right: auto;\">\n      <div class=\"is-block column is-4-fullhd is-4-desktop is-4-tablet is-12-mobile\">\n        <button type=\"reset\" onclick=\"alert('Not Implemented Yet.')\" class=\"button is-block is-warning\" style=\"margin: 7px auto; width: 100%;\">\n          <i class=\"fas fa-undo\" style=\"position: relative; top: 4px; left: 2px;\"></i>\n          <span>Reset</span>\n        </button>\n      </div>\n      <div class=\"is-block column is-4-fullhd is-4-desktop is-4-tablet is-12-mobile\">\n        <button type=\"submit\" onclick=\"updateQuest()\" class=\"button is-block is-success\" style=\"margin: 7px auto; width: 100%;\">\n          <i class=\"fas fa-check\" style=\"position: relative; top: 4px; left: 2px;\"></i>\n          <span>Save</span>\n        </button>\n      </div>\n      <div class=\"is-block column is-4-fullhd is-4-desktop is-4-tablet is-12-mobile\">\n        <button onclick=\"if (confirm('Delete question?')) destroyQuest(").concat(a.id,")\" class=\"button is-block is-danger\" style=\"margin: 7px auto; width: 100%;\">\n          <i class=\"fas fa-times\" style=\"position: relative; top: 4px; left: 2px;\"></i>\n          <span>Delete</span>\n        </button>\n      </div>\n    </div>\n  ")}/**
 * Memorize the changes made to the input (or contenteditable) fields.
 */function saveProgress(){var a=document.getElementById("module-edit-pane"),b=getSelId("Module"),c=getSelId("Lesson"),d=getSelId("Question");if(b&&c&&!d);else{if(b&&!c&&d){if(!a.querySelector("#module-edit-question-answer"))return;var e=JSON.stringify([{authorId:JSON.parse(sessionStorage.getItem("loggedIn")).id,badAnswer1:a.querySelector("#module-edit-question-bad-answer-1").innerText.trim(),badAnswer2:a.querySelector("#module-edit-question-bad-answer-2").innerText.trim(),badAnswer3:a.querySelector("#module-edit-question-bad-answer-3").innerText.trim(),correctAnswer:a.querySelector("#module-edit-question-answer").innerText.trim(),name:a.querySelector("#module-edit-question-name").innerText.trim()}]);return sessionStorage.setItem("".concat(location.pathname,"/questions?id=").concat(d),e),sessionStorage.setItem("".concat(location.pathname,"/questions?id=").concat(d,"&moduleId=").concat(b),e)}if(b&&!c&&!d)return a.querySelector("#module-edit-name")?sessionStorage.setItem("".concat(location.pathname,"/modules?id=").concat(b),JSON.stringify([{name:a.querySelector("#module-edit-name").innerText.trim(),topic:a.querySelector("#module-edit-topic").innerText.trim(),authorId:JSON.parse(sessionStorage.getItem("loggedIn")).id,summary:a.querySelector("#module-edit-summary").value.trim()}])):void 0}}/**
 * Toggle module. Run when a module is pressed. Shows the module-edit pane.
 *
 * @param {!Number} id
 * @return {Promise<void>}
 */function toggleModule(){return _toggleModule.apply(this,arguments)}/**
 * Toggle module. Run when a module is pressed. Shows the module-edit pane.
 *
 * @param {!Number} id
 * @return {Promise<void>}
 */function _toggleModule(){return _toggleModule=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var c,d,e;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(saveClick("Module",b),saveProgress(),c=getSelId("Module"),c!==b||getSelId("Lesson")||getSelId("Question")){a.next=5;break}return a.abrupt("return");case 5:if(document.querySelectorAll("#module-edit-list-module > li[data-id]").forEach(function(a){return a.setAttribute("disabled","true")}),document.getElementById("module-edit-pane").innerHTML="\n    <p class=\"has-text-centered\" style=\"margin: 20px auto;\">\n      <span style=\"margin-bottom: 15px;\">Loading</span>\n      <br>\n      <i class=\"fas fa-spinner spinner\"></i>\n    </p>",unSelect("Lesson"),unSelect("Question"),c===b){a.next=24;break}return unSelect("Module"),select("Module",b),clearList("Lesson"),clearList("Question"),document.getElementById("module-edit-spinner-list-lesson").classList.remove("is-hidden"),document.getElementById("module-edit-spinner-list-question").classList.remove("is-hidden"),d=get("Lesson",{moduleId:b}).then(function(a){return Promise.all(a.map(function(a){return appendLesson(a)}))}),e=get("Question",{moduleId:b}).then(function(a){return Promise.all(a.map(function(a){return appendQuestion(a)}))}),a.next=20,d;case 20:return a.next=22,e;case 22:document.getElementById("module-edit-spinner-list-lesson").classList.add("is-hidden"),document.getElementById("module-edit-spinner-list-question").classList.add("is-hidden");case 24:return document.querySelectorAll("#module-edit-list-module > li").forEach(function(a){return a.removeAttribute("disabled")}),a.t0=showModEditPane,a.next=28,get("Module",{id:b}).then(function(a){return a[0]});case 28:return a.t1=a.sent,a.abrupt("return",(0,a.t0)(a.t1));case 30:case"end":return a.stop();}},a,this)})),_toggleModule.apply(this,arguments)}function toggleLesson(){return _toggleLesson.apply(this,arguments)}/**
 * Toggle question. Run when a question is pressed. Shows the question-edit pane.
 *
 * @param {!Number} id
 * @return {Promise<void>}
 */function _toggleLesson(){return _toggleLesson=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var c,d;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(c=getSelId("Lesson"),b!==c){a.next=3;break}return a.abrupt("return");case 3:return document.querySelectorAll("#module-edit-list-lesson > li[data-id]").forEach(function(a){return a.setAttribute("disabled","true")}),document.getElementById("module-edit-pane").innerHTML="\n    <p class=\"has-text-centered\" style=\"margin: 20px auto;\">\n      <span style=\"margin-bottom: 15px;\">Loading</span>\n      <br>\n      <i class=\"fas fa-spinner spinner\"></i>\n    </p>",saveClick("Lesson",b),saveProgress(),unSelect(null===c?"Question":"Lesson"),select("Lesson",b),a.next=11,get("Lesson",{id:b,moduleId:getSelId("Module")});case 11:return d=a.sent[0],document.querySelectorAll("#module-edit-list-lesson > li[data-id]").forEach(function(a){return a.removeAttribute("disabled")}),a.t0=showLessEditPane,a.t1=d,a.next=17,get("File",{lessonId:d.id});case 17:return a.t2=a.sent,a.next=20,(0,a.t0)(a.t1,a.t2);case 20:return a.abrupt("return",a.sent);case 21:case"end":return a.stop();}},a,this)})),_toggleLesson.apply(this,arguments)}function toggleQuestion(){return _toggleQuestion.apply(this,arguments)}/**
 * Appends a new module to module list (left-most list).
 *
 * @param {{id: !Number, authorId: !Number, name: ?String}} module
 */function _toggleQuestion(){return _toggleQuestion=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(b!==getSelId("Question")){a.next=2;break}return a.abrupt("return");case 2:return document.querySelectorAll("#module-edit-list-question > li[data-id]").forEach(function(a){return a.setAttribute("disabled","true")}),document.getElementById("module-edit-pane").innerHTML="\n    <p class=\"has-text-centered\" style=\"margin: 20px auto;\">\n      <span style=\"margin-bottom: 15px;\">Loading</span>\n      <br>\n      <i class=\"fas fa-spinner spinner\"></i>\n    </p>",saveClick("Question",b),saveProgress(),unSelect("Question"),unSelect("Lesson"),select("Question",b),document.querySelectorAll("#module-edit-list-question > li[data-id]").forEach(function(a){return a.removeAttribute("disabled")}),a.t0=showQuestEditPane,a.next=13,get("Question",{id:b,moduleId:getSelId("Module")});case 13:return a.t1=a.sent[0],a.next=16,(0,a.t0)(a.t1);case 16:return a.abrupt("return",a.sent);case 17:case"end":return a.stop();}},a,this)})),_toggleQuestion.apply(this,arguments)}function appendModule(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{id:null,name:null};document.getElementById("module-edit-list-module").innerHTML+="\n    <li data-id=\"".concat(a.id,"\">\n      <a onclick=\"toggleModule(").concat(a.id,")\" style=\"min-width: 100px; padding: 10px; margin-right: 5px; display: flex; flex-direction: row; justify-content: space-between; align-items: center;\">\n        <span>").concat(a.name?a.name:"unnamed #"+a.id.toString(),"</span>\n        <button class=\"button is-danger is-small\" style=\"width: 20px; height: 23px;\" onclick=\"if (confirm('Delete module?')) destroyMod(").concat(a.id,");\">\n          <i class=\"fas fa-times fa-xs\" style=\"margin: initial;\"></i>\n        </button>\n      </a>\n    </li>\n    ")}/**
 * Appends a lesson to the list of lessons AND created a form for editing it.
 *
 * @param {{id: !Number, moduleId: !Number, name: ?String}} lesson
 */function appendLesson(a){// append to the second (lesson) menu
document.getElementById("module-edit-list-lesson").innerHTML+="\n    <li data-id=\"".concat(a.id,"\"\n        data-module-id=\"").concat(a.moduleId,"\">\n      <a onclick=\"toggleLesson(").concat(a.id,")\" style=\"padding: 5px 10px; display: flex; flex-direction: row; justify-content: space-between; align-items: center;\">\n        <span>").concat(a.name?a.name:"unnamed #"+a.id,"</span>\n        <div style=\"display: flex; flex-direction: row; justify-content: space-between;\">\n          <button class=\"button is-small is-danger\" onclick=\"if (confirm('Delete lesson?')) destroyLess(").concat(a.id,");\" style=\"width: 20px; height: 23px;\">\n            <i class=\"fas fa-times fa-xs\" style=\"margin: initial;\"></i>\n          </button>\n        </div>\n      </a>\n    </li>\n    ")}/**
 * Appends a question to the quiz for the selected module.
 *
 * @param {{id: !Number, moduleId: !Number, name: ?String, correctAnswer: ?String, badAnswer1: ?String, badAnswer2: ?String, badAnswer3: ?String}} question
 */function appendQuestion(a){document.querySelector("#module-edit-list-question").innerHTML+="\n    <li data-id=\"".concat(a.id,"\"\n        data-module-id=\"").concat(a.moduleId,"\">\n      <a class=\"has-text-dark\" onclick=\"toggleQuestion(").concat(a.id,")\" style=\"padding: 5px 10px; display: flex; flex-direction: row; justify-content: space-between; align-items: center;\">\n        <span>").concat(a.name?a.name:"unnamed #"+a.id,"</span>\n        <div style=\"display: flex; flex-direction: row; justify-content: space-between;\">\n          <button class=\"button is-small is-danger\" onclick=\"if (confirm('Delete question?')) destroyQuest(").concat(a.id,");\" style=\"width: 20px; height: 23px;\">\n            <i class=\"fas fa-times fa-xs\" style=\"margin: initial;\"></i>\n          </button>\n        </div>\n      </a>\n    </li>\n  ")}/**
 * Adds attachment to a list of attachments in a lesson.
 *
 * @param {!{id: ?Number, lessonId: !Number, name: !String}} file
 * @return {void}
 */function appendAttachment(){return _appendAttachment.apply(this,arguments)}function _appendAttachment(){return _appendAttachment=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var c;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,void 0!==b.id){a.next=5;break}return a.next=4,get("File",{lessonId:b.lessonId,name:b.name}).then(function(a){return a[0].id});case 4:b.id=a.sent;case 5:c=document.getElementById("module-edit-list-attachments"),c.innerHTML+="\n    <li class=\"has-text-black has-background-light\"\n        data-name=\"".concat(b.name,"\"\n        data-id=\"").concat(b.id,"\"\n        style=\"padding: 10px; margin-bottom: 10px; width: 100%;\">\n      <p style=\"margin-bottom: auto; margin-top: auto; float: left; position: relative; top: 4px;\">").concat(b.name,"</p>\n      <div style=\"margin-bottom: auto; margin-top: auto; float: right;\">\n        <a href=\"/file/").concat(b.id,"\" class=\"button is-link is-small has-text-white\" download=\"").concat(b.name,"\" style=\"\">\n          Download\n          <!--<i class=\"fas fa-download is-block\"></i>-->\n        </a>\n        <a onclick=\"destroyAttach(").concat(b.id,", ").concat(b.lessonId,")\" class=\"button is-small is-danger\" style=\"\">\n          Delete\n          <!--<i class=\"fas fa-times is-block\"></i>-->\n        </a>\n      </div>\n    </li>\n      "),a.next=13;break;case 9:return a.prev=9,a.t0=a["catch"](0),console.error(a.t0),a.abrupt("return",alert(a.t0.message||a.t0.toString()));case 13:case"end":return a.stop();}},a,this,[[0,9]])})),_appendAttachment.apply(this,arguments)}function setLessContent(){var a=getSelId("Lesson");document.querySelector("form #module-edit-lesson-content").innerHTML="\n    <p class=\"lesson-edit-msg-has-lesson\">\n      <br>\n      <strong>NOTE</strong>\n      <br>\n      You have already uploaded lesson content!\n      <br>\n      Feel free to <strong>replace</strong> it by re-uploading another file.\n    </p>\n    <br>\n    <a href=\"/api/lesson/".concat(a,"/download\"\n       class=\"button is-link is-small has-text-centered has-text-white\"\n       download=\"lesson.html\">\n      <i class=\"fas fa-download icon\"></i>\n      <span>Download</span>\n    </a>\n    <!--<button class=\"button is-danger is-small\" onclick=\"destroyLess(").concat(a,").then(() => unsetLessContent())\">\n      <i class=\"fas fa-times icon\"></i>\n      <span>Delete</span>\n    </button>\n    -->\n  ")}/**
 * Remove the HTML content file from a lesson.
 */function unsetLessContent(){document.querySelector("form #module-edit-lesson-content").innerHTML="\n    <ul style=\"display: flex; flex-direction: column; justify-content: space-around;\">\n      <li>\n        <p><em>Only</em> include the <em>content</em> of the <code>&lt;body&gt;</code> tag</p>\n      </li>\n      <li>\n        <p>We will only accept <strong>HTML</strong> files</p>\n      </li>\n    </ul>\n  "}/**
 * Modifies a module and updates UI.
 *
 * @return {Promise<void>}
 */function updateMod(){return _updateMod.apply(this,arguments)}/**
 * Modifies a lesson and updates UI.
 *
 * TODO ensure file names are unique.
 *
 * @return {Promise<void>}
 */function _updateMod(){return _updateMod=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(){var b,c,d,e,f,g;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=document.getElementById("module-edit-pane"),c=b.querySelector("#module-edit-name").innerText,d=b.querySelector("#module-edit-topic").innerText,e=b.querySelector("#module-edit-summary").value,f=getSelId("Module"),a.prev=5,a.next=8,update("Module",f,JSON.stringify({summary:e?e:null,name:c?c:null,topic:d?d:null}));case 8:sessionStorage.removeItem("".concat(location.pathname,"/modules?authorId=").concat(JSON.parse(sessionStorage.getItem("loggedIn")).id)),sessionStorage.removeItem("".concat(location.pathname,"/modules?id=").concat(f)),a.next=17;break;case 12:return a.prev=12,a.t0=a["catch"](5),g=a.t0.msg||a.t0.message||a.t0.toString(),console.error(a.t0),a.abrupt("return",alert(g));case 17:return document.querySelector("#module-edit-list-module li[data-id='".concat(f,"'] > a > span")).innerText=c?c:"unnamed ".concat(f),a.abrupt("return",alert("Updated module."));case 19:case"end":return a.stop();}},a,this,[[5,12]])})),_updateMod.apply(this,arguments)}function updateLess(){return _updateLess.apply(this,arguments)}/**
 * TODO Modifies a question and updates UI.
 *
 * @return {Promise<void>}
 */function _updateLess(){return _updateLess=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(){var b,c,d,e,g,h,i,j,k,l,m,n,o,p;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,b=document.querySelector("#module-edit-pane form"),c=getSelId("Lesson"),d=new FormData,e=b.querySelector("input[type=file]:not([multiple])"),g=0<e.files.length,!g){a.next=12;break}if(e.files[0].name.match(/\.x?html?$/i)){a.next=11;break}return a.abrupt("return",alert("Lesson must be an HTML file."));case 11:d.append("lesson",e.files[0],"lesson.html");case 12:h=b.querySelector("input[type=file][multiple]").files,i=!0,j=!1,k=void 0,a.prev=16,l=h[Symbol.iterator]();case 18:if(i=(m=l.next()).done){a.next=28;break}if(n=m.value,n.name.match(/\.((pn|jp)g|gif|mp[34g])$/i)){a.next=24;break}return a.abrupt("return",alert("Invalid attachment file type ".concat(n.name,".")));case 24:d.append(n.name,n);case 25:i=!0,a.next=18;break;case 28:a.next=34;break;case 30:a.prev=30,a.t0=a["catch"](16),j=!0,k=a.t0;case 34:a.prev=34,a.prev=35,i||null==l.return||l.return();case 37:if(a.prev=37,!j){a.next=40;break}throw k;case 40:return a.finish(37);case 41:return a.finish(34);case 42:return o=b.querySelector("input[name=name]").value.trim(),d.append("name",o),d.append("summary",b.querySelector("textarea[name=summary]").value.trim()),console.debug(_toConsumableArray(d.entries())),a.next=48,update("Lesson",c,d,null);case 48:return g&&setLessContent(c),a.next=51,Promise.all(Array.from(h).map(function(a){return appendAttachment({id:a.id,name:a.name,lessonId:c})}));case 51:return p=getSelId("Module"),sessionStorage.removeItem("".concat(location.pathname,"/lessons?id=").concat(c,"&moduleId=").concat(p)),sessionStorage.removeItem("".concat(location.pathname,"/lessons?id=").concat(c)),sessionStorage.removeItem("".concat(location.pathname,"/lessons?moduleId=").concat(p)),sessionStorage.removeItem("".concat(location.pathname,"/files?lessonId=").concat(c)),o=b.querySelector("input[name=name]").value.trim(),b.querySelector("input[type=file][multiple]").outerHTML="\n      <input type=\"file\" name=\"attachments\" class=\"is-paddingless\" multiple style=\"display: block\">\n    ",document.querySelector("#module-edit-list-lesson li[data-id='".concat(c,"'] > a > span")).innerText=o?o:"unnamed ".concat(c),a.abrupt("return",alert("Updated lesson."));case 62:return a.prev=62,a.t1=a["catch"](0),console.error(a.t1),a.abrupt("return",alert(a.t1.msg||a.t1.message||a.t1.toString()));case 66:case"end":return a.stop();}},a,this,[[0,62],[16,30,34,42],[35,,37,41]])})),_updateLess.apply(this,arguments)}function updateQuest(){return _updateQuest.apply(this,arguments)}/**
 * Destroys a module.
 *
 * @param {!Number} id
 * @return {void}
 */function _updateQuest(){return _updateQuest=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(){var b,c,d,e,f,g,h,i;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=getSelId("Question"),c=getSelId("Module"),sessionStorage.removeItem("".concat(location.pathname,"/questions?moduleId=").concat(c)),sessionStorage.removeItem("".concat(location.pathname,"/questions?id=").concat(b,"&moduleId=").concat(c)),d=document.getElementById("module-edit-pane"),e=d.querySelector("#module-edit-question-name").innerText,f=d.querySelector("#module-edit-question-answer").innerText,g=d.querySelector("#module-edit-question-bad-answer-1").innerText,h=d.querySelector("#module-edit-question-bad-answer-2").innerText,i=d.querySelector("#module-edit-question-bad-answer-3").innerText,a.next=12,update("Question",b,JSON.stringify({id:b,moduleId:c,name:e?e:null,badAnswer1:g?g:null,badAnswer2:h?h:null,badAnswer3:i?i:null,correctAnswer:f?f:null}));case 12:return document.querySelector("#module-edit-list-question li[data-id='".concat(b,"'] > a > span")).innerText=e?e:"unnamed #".concat(b),a.abrupt("return",alert("Updated question."));case 14:case"end":return a.stop();}},a,this)})),_updateQuest.apply(this,arguments)}function destroyMod(a){return destroy("Module",a),sessionStorage.removeItem("".concat(location.pathname,"/modules?authorId=").concat(JSON.parse(sessionStorage.getItem("loggedIn")).id)),getSelId("Module")===a&&(clearPane(),clearList("Lesson"),clearList("Question")),document.querySelector("#module-edit-list-module li[data-id='".concat(a,"']")).remove()}/**
 * Destroys a lesson.
 *
 * @param {!Number} id
 * @return {void}
 */function destroyLess(a){return destroy("Lesson",a),sessionStorage.removeItem("".concat(location.pathname,"/lessons?moduleId=").concat(getSelId("Module"))),getSelId("Lesson")===a&&clearPane(),document.querySelector("#module-edit-list-lesson li[data-id='".concat(a,"']")).remove()}/**
 * Destroys a question.
 *
 * @param {!Number} id
 * @return {void}
 */function destroyQuest(a){return destroy("Question",a),sessionStorage.removeItem("".concat(location.pathname,"/questions?moduleId=").concat(getSelId("Module"))),getSelId("Question")===a&&clearPane(),document.querySelector("#module-edit-list-question li[data-id='".concat(a,"']")).remove()}/**
 * Destroys an attachment (file).
 *
 * @param {{id: !Number, lessonId: !Number}} file
 * @return {Promise<void|!String>}
 */function destroyAttach(a,b){// clear cache
return sessionStorage.removeItem("".concat(location.pathname,"/files?lessonId=").concat(b)),document.querySelector("#module-edit-list-attachments li[data-id='".concat(a,"']")).remove(),destroy("File",a)}/**
 * Creates a module.
 *
 * @return {Promise<void>}
 */ /**
 * Creates a lesson.
 *
 * @return {Promise<void>}
 */ /**
 * Creates a question.
 *
 * @return {Promise<void>}
 */ /**
 * Populate the page using AJAX.
 *
 * Try to recall last click.
 */document.getElementById("module-edit-btn-module-create").onclick=/*#__PURE__*/function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var c,d;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b.preventDefault(),c=JSON.parse(sessionStorage.getItem("loggedIn")).id,a.prev=2,d=create("Module",JSON.stringify({authorId:c})),sessionStorage.removeItem("".concat(location.pathname,"/modules?authorId=").concat(c)),a.t0=appendModule,a.next=8,d;case 8:return a.t1=a.sent,a.abrupt("return",(0,a.t0)(a.t1));case 12:a.prev=12,a.t2=a["catch"](2),console.error(a.t2),alert("Your session expired."),location.pathname="/";case 17:case"end":return a.stop();}},a,this,[[2,12]])}));return function(){return a.apply(this,arguments)}}(),document.getElementById("module-edit-btn-lesson-create").onclick=/*#__PURE__*/function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var c,d;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(b.preventDefault(),c=getSelId("Module"),c){a.next=4;break}return a.abrupt("return",alert("Module must be selected."));case 4:return a.prev=4,d=create("Lesson",JSON.stringify({moduleId:c})),sessionStorage.removeItem("".concat(location.pathname,"/lessons?moduleId=").concat(c)),a.t0=appendLesson,a.next=10,d;case 10:return a.t1=a.sent,a.abrupt("return",(0,a.t0)(a.t1));case 14:a.prev=14,a.t2=a["catch"](4),console.error(a.t2),alert("Your session expired."),location.pathname="/";case 19:case"end":return a.stop();}},a,this,[[4,14]])}));return function(){return a.apply(this,arguments)}}(),document.getElementById("module-edit-btn-question-create").onclick=/*#__PURE__*/function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var c,d;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(b.preventDefault(),c=getSelId("Module"),c){a.next=4;break}return a.abrupt("return",alert("Module must be selected."));case 4:return a.prev=4,d=create("Question",JSON.stringify({moduleId:c})),sessionStorage.removeItem("".concat(location.pathname,"/questions?moduleId=").concat(c)),a.t0=appendQuestion,a.next=10,d;case 10:return a.t1=a.sent,a.abrupt("return",(0,a.t0)(a.t1));case 14:a.prev=14,a.t2=a["catch"](4),console.error(a.t2),alert("Your session expired."),location.pathname="/";case 19:case"end":return a.stop();}},a,this,[[4,14]])}));return function(){return a.apply(this,arguments)}}(),_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(){var b,c,d,e,f,g,h,i,j;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,b=/*#__PURE__*/function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if("module"===h){a.next=4;break}return a.abrupt("return",!1);case 4:if(document.querySelector("#module-edit-list-module li[data-id='".concat(JSON.parse(f).id,"'] > a"))){a.next=6;break}return a.abrupt("return",!1);case 6:return a.next=8,toggleModule(JSON.parse(f).id);case 8:return a.abrupt("return",!0);case 9:case"end":return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}(),c=/*#__PURE__*/function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(){var b,c;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if("lesson"===h){a.next=2;break}return a.abrupt("return",!1);case 2:return a.next=4,get("Lesson",{id:i});case 4:if(b=a.sent,0!==b.length){a.next=7;break}return a.abrupt("return",!1);case 7:if(c=b[0].moduleId,document.querySelector("#module-edit-list-module li[data-id='".concat(c,"'] > a"))){a.next=10;break}return a.abrupt("return",!1);case 10:return a.next=12,toggleModule(c);case 12:if(document.querySelector("#module-edit-list-lesson li[data-id='".concat(i,"'] > a"))){a.next=14;break}return a.abrupt("return",!1);case 14:return a.next=16,toggleLesson(i);case 16:return a.abrupt("return",!0);case 17:case"end":return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}(),d=/*#__PURE__*/function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(){var b,c;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if("question"===h){a.next=2;break}return a.abrupt("return",!1);case 2:return a.next=4,get("Question",{id:i});case 4:if(b=a.sent,0!==b.length){a.next=7;break}return a.abrupt("return",!1);case 7:if(c=b[0].moduleId,document.querySelector("#module-edit-list-module li[data-id='".concat(c,"'] > a"))){a.next=10;break}return a.abrupt("return",!1);case 10:return a.next=12,toggleModule(c);case 12:if(document.querySelector("#module-edit-list-question li[data-id='".concat(i,"'] > a"))){a.next=14;break}return a.abrupt("return",!1);case 14:return a.next=16,toggleQuestion(i);case 16:return a.abrupt("return",!0);case 17:case"end":return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}(),document.getElementById("module-edit-spinner-list-module").classList.remove("is-hidden"),e=sessionStorage.getItem("loggedIn"),e){a.next=8;break}return a.abrupt("return",logOut());case 8:return a.next=10,get("Module",{authorId:JSON.parse(e).id}).then(function(a){return Promise.all(a.map(function(a){return appendModule(a)}))});case 10:if(document.getElementById("module-edit-spinner-list-module").classList.add("is-hidden"),f=sessionStorage.getItem("".concat(location.pathname,"?click")),f){a.next=14;break}return a.abrupt("return",!1);case 14:return g=JSON.parse(f),h=g.page,i=g.id,a.next=17,b();case 17:if(a.t0=a.sent,a.t0){a.next=27;break}return a.next=21,c();case 21:if(a.t1=a.sent,a.t1){a.next=26;break}return a.next=25,d();case 25:a.t1=a.sent;case 26:a.t0=a.t1;case 27:return a.abrupt("return",a.t0);case 30:return a.prev=30,a.t2=a["catch"](0),j=a.t2.msg||a.t2.message||a.t2.toString(),console.error(a.t2),a.abrupt("return",alert(j));case 35:case"end":return a.stop();}},a,this,[[0,30]])}))();