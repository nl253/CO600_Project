{"version":3,"sources":["register.js"],"names":["document","getElementById","oninput","elPassword","style","background","value","onclick","event","preventDefault","modal","querySelector","html","classList","add","addEventListener","e","remove","vars","email","trim","password","alert","maybeFirstName","firstName","maybeLastName","lastName","fetch","method","redirect","cache","credentials","headers","body","JSON","stringify","regRes","status","console","error","json","err","msg","message","toString","mode","logInRes","sessionStorage","setItem","result","setCookie","token","location","pathname","endsWith"],"mappings":"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","sourcesContent":["document.getElementById('reg-password-2').oninput = function() {\n  const elPassword = document.getElementById('reg-password');\n  this.style.background = elPassword.value !== this.value ?\n    '#ffbaba' :\n    '#e7fdd1';\n  elPassword.style.background = elPassword.value !== this.value ?\n    '#ffbaba' :\n    '#e7fdd1';\n};\n\ndocument.getElementById('reg-btn').onclick = async (event) => {\n\n  event.preventDefault();\n\n    // Ask to set cookie\n\n    const modal = document.querySelector('.modal');\n    const html = document.querySelector('html');\n    modal.classList.add('is-active');\n    html.classList.add('is-clipped');\n\n    modal.querySelector('.modal-background').addEventListener('click', function(e) {\n      e.preventDefault();\n      modal.classList.remove('is-active');\n      html.classList.remove('is-clipped');\n    });\n\n    document.getElementById('register-allowCookies-btn').onclick = async (event) => {\n      const vars = {\n        email: document.getElementById('reg-email').value.trim(),\n        password: document.getElementById('reg-password').value,\n      };\n\n      if (document.getElementById('reg-password-2').value !== vars.password) {\n        return alert('passwords don\\'t match');\n      }\n\n      let maybeFirstName = document.getElementById('reg-first-name').value.trim();\n      if (maybeFirstName !== '') vars.firstName = maybeFirstName;\n\n      let maybeLastName = document.getElementById('reg-last-name').value.trim();\n      if (maybeLastName !== '') vars.lastName = maybeLastName;\n\n      try {\n        const regRes = await fetch(`/api/user/register`, {\n          method: 'post',\n          redirect: 'follow',\n          cache: 'no-cache',\n          credentials: 'include',\n          headers: {\n            'Content-Type': 'application/json',\n            'Accept': 'application/json',\n          },\n          body: JSON.stringify(vars),\n        });\n\n        if (regRes.status >= 400) {\n          console.error(regRes);\n          const err = await regRes.json();\n          const msg = err.msg || err.message || err.toString();\n          console.error(msg);\n          document.querySelector('.modal.is-active').classList.add('is-clipped');\n          document.querySelector('.modal.is-active').classList.remove('is-active');\n          return alert(msg);\n        }\n\n        // error codes 400..499 and 500..599 are client and server errors\n        const logInRes = await fetch(`/api/user/login`, {\n          method: 'post',\n          redirect: 'follow',\n          cache: 'no-cache',\n          mode: 'cors',\n          credentials: 'include',\n          headers: {\n            'Content-Type': 'application/json',\n            'Accept': 'application/json',\n          },\n          body: JSON.stringify({email: vars.email, password: vars.password}),\n        });\n\n        if (logInRes.status >= 400) {\n          const err = await logInRes.json();\n          const msg = err.msg || err.message || err.toString();\n          console.error(msg);\n          return alert(msg);\n        }\n\n        // result should store the token if things go well\n        const json = await logInRes.json();\n        sessionStorage.setItem('loggedIn', JSON.stringify(json.result));\n        setCookie('token', json.result.token);\n        // redirect\n        location.pathname = location.pathname.endsWith('/register')\n        ? '/'\n        : location.pathname;\n      } catch (err) {\n        const msg = err.msg || err.message || err.toString();\n        console.error(err);\n        return alert(msg);\n      }\n    };\n\n    document.getElementById('register-noCookies-btn').onclick = (event) => {\n      event.preventDefault();\n      modal.classList.remove('is-active');\n      html.classList.remove('is-clipped');\n    }\n};\n"]}