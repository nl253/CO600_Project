{"version":3,"sources":["settings.js"],"names":["document","getElementById","onclick","event","preventDefault","details","changedAttrs","emailEl","email","value","infoEl","info","firstNameEl","firstName","lastNameEl","lastName","Object","keys","k","push","fetch","method","withCredentials","cache","body","JSON","stringify","redirect","mode","headers","detailsChangeResp","status","json","err","msg","message","toString","console","error","alert","elOldPass","elEmail","indexOf","length","elNewPass","elNewPass2","reduce","prev","cur","join","assign","password","passChangeResp"],"mappings":"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","sourcesContent":["document.getElementById('user-btn-modify-details').onclick = async (event) => {\n  try {\n    event.preventDefault();\n    const details = {};\n    const changedAttrs = [];\n    const emailEl = document.getElementById('user-input-email');\n    details.email = emailEl.value;\n    const infoEl = document.getElementById('user-info');\n    details.info = infoEl.value === '' ? null : infoEl.value;\n    const firstNameEl = document.getElementById('user-first-name');\n    details.firstName = firstNameEl.value === '' ? null : firstNameEl.value;\n    const lastNameEl = document.getElementById('user-last-name');\n    details.lastName = lastNameEl.value === '' ? null : lastNameEl.value;\n    for (const k of Object.keys(details)) changedAttrs.push(k);\n    const detailsChangeResp = await fetch('/api/user', {\n      method: 'POST',\n      withCredentials: true,\n      cache: 'no-cache',\n      body: JSON.stringify(details),\n      redirect: 'follow',\n      mode: 'cors',\n      headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json',\n      },\n    });\n    if (detailsChangeResp.status >= 400) {\n      const err = await detailsChangeResp.json();\n      const msg = err.msg || err.message || err.toString();\n      console.error(msg);\n      return alert(msg);\n    }\n    const json = await detailsChangeResp.json();\n    const elOldPass = document.getElementById('user-password-old');\n    const elEmail = document.getElementById('user-input-email');\n    if (elEmail.value === '' || elEmail.value.indexOf('@') <= 0 ||\n      elEmail.value.length <= 4) {\n      return alert('bad email format, cannot change password');\n    }\n    const elNewPass = document.getElementById('user-password-new');\n    const elNewPass2 = document.getElementById('user-password-new-2');\n    // if all password fields empty\n    if ([elOldPass, elNewPass, elNewPass2].reduce(\n      (prev, cur) => cur.value === '' && prev, true)) {\n      return alert(`successfully modified ${changedAttrs.join(', ')}`);\n    }\n    changedAttrs.push('password');\n    // if any passwords are empty\n    if ([elOldPass, elNewPass, elNewPass2].reduce(\n      (prev, cur) => prev || cur.value === '', false)) {\n      return alert('empty password');\n    }\n    if (elNewPass.value !== elNewPass2.value) {\n      return alert('new passwords don\\'t match');\n    }\n    if (elNewPass.value === elOldPass.value) {\n      return alert('old and new password are exactly the same');\n    }\n    const passChangeResp = await fetch('/api/user/password', Object.assign({\n        method: 'POST',\n        withCredentials: true,\n        cache: 'no-cache',\n        body: JSON.stringify(details),\n        redirect: 'follow',\n        mode: 'cors',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json',\n        },\n      }, {\n        body: JSON.stringify({\n          value: elNewPass.value,\n          password: elOldPass.value,\n          email: elEmail.value,\n        }),\n      }),\n    );\n    if (passChangeResp.status >= 400) {\n      const err = await passChangeResp.json();\n      const msg = err.msg || err.message || err.toString();\n      console.error(msg);\n      return alert(msg);\n    } else {\n      alert(`successfully modified ${changedAttrs.join(', ')}`);\n    }\n  } catch (e) {\n    const msg = e.msg || e.message || e.toString();\n    console.error(msg);\n    return alert(msg);\n  }\n};\n\n"]}