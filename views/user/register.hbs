<section class="hero is-fullheight is-primary is-bold">
  </div>
  <div class="hero-head">

  </div>
  <div class="hero-body">
    <div class="container is-widescreen">
      <div class="columns">
        <div class="column is-half">
          <h1 class="title is-1">Welcome</h1>
          <p>WEBSITE NAME is all about learning together freely! As a user on this website,
            you are able to see and learn from lessons and modules posted by other users.
            Register, and you will be able to upload content of your own for other users
            to learn from. Content creators can invite users to subscribe to their modules
            and be able to receive feedback and take a module test which, if completed successfully,
            will reward them with an online certificate for that module. <br><br> Thank you
            for visiting, enjoy your learning.

          </p>
        </div>
        <div class="column is-half">
          <article class="message">
            <div class="message-header">Don't have an account?</div>
            <div class="message-body">
              <form>
                <h1 class="title is-4 has-text-primary">Register!</h1>
                <div class="field">
                  <label class="label">First Name</label>
                  <div class="control">
                    <input class="input" id="firstName" type="text" placeholder="e.g. Amy">
                  </div>
                </div>
                <div class="field">
                  <label class="label">Surname</label>
                  <div class="control">
                    <input class="input" id="surname" type="text" placeholder="e.g. Adams">
                  </div>
                </div>
                <div class="field">
                  <label class="label">Email</label>
                  <div class="control has-icons-left">
                    <input class="input" id="regEmail" type="email" pattern=".{2,}@.{2,}\..{2,}" placeholder="example@email.com"
                      autocomplete="on" required>
                    <span class="icon is-small is-left">
                      <i class="fa fa-envelope"></i>
                    </span>
                  </div>
                </div>
                <div class="field">
                  <label class="label">Confirm Email</label>
                  <div class="control has-icons-left">
                    <input class="input" type="email" pattern=".{2,}@.{2,}\..{2,}" placeholder="example@email.com"
                      autocomplete="on" required>
                    <span class="icon is-small is-left">
                      <i class="fa fa-envelope"></i>
                    </span>
                  </div>
                </div>
                <div class="field">
                  <label class="label">Password</label>
                  <div class="control has-icons-left">
                    <input class="input" id="regPassword" type="password" pattern=".{6,}" required>
                    <span class="icon is-small is-left">
                      <i class="fa fa-lock"></i>
                    </span>
                  </div>
                </div>
                <div class="field">
                  <label class="label">Confirm Password</label>
                  <div class="control has-icons-left">
                    <input class="input" type="password" pattern=".{6,}" required>
                    <span class="icon is-small is-left">
                      <i class="fa fa-lock"></i>
                    </span>
                  </div>
                </div>
                <div class="control">
                  <button class="button is-primary" id="registerBtn">Submit</button>
                </div>
              </form>
            </div>
          </article>
        </div>
      </div>
    </div>
  </div>
</section>


<script>

  document.getElementById('registerBtn').onclick = (event) => {

      event.preventDefault();

      let [firstName, lastName] = [null, null];

      let maybeFirstName = document.getElementById("firstName").value;
      if (maybeFirstName !== "") firstName = maybeFirstName;

      let maybeLastName = document.getElementById("firstName").value;
      if (maybeLastName !== "") lastName = maybeLastName;

      const email = document.getElementById("regEmail").value;
      const password = document.getElementById("regPassword").value;
      const userDetails = { firstName, lastName, email, password };

      const cfg = {
        method: "POST",
        redirect: "follow",
        cache: "no-cache",
        mode: "cors",
        credentials: "include",
        headers: {
          "Content-Type": "application/json",
          "Accept": "application/json",
        },
        body: JSON.stringify(userDetails),
      }

      return fetch(`/api/user/register`, cfg)
        .then(response => response.status >= 400 
          ? Promise.reject(response.json()) 
          : response.json())
        .then(json => {

          const credentials = { email, password };

          const cfg = {
            method: "POST",
            redirect: 'follow',
            cache: "no-cache",
            mode: "cors",
            credentials: "include",
            headers: {
              "Content-Type": "application/json",
              "Accept": "application/json",
            },
            body: JSON.stringify(credentials),
          };

          // error codes 400..499 and 500..599 are client and server errors
          return fetch(`/api/user/login`, cfg)
            .then(response => response.status >= 400 
              // if it goes wrong force it to jump to reject
              ? Promise.reject(response.json()) 
              // the JSON object is guaranteed to have a "msg" property
              : response.json())
            .then(json => {
              // result should store the token if things go well
              const token = json.result;
              setCookie('token', token);
              // redirect
              window.location = '/user/profile';
            });
        }).catch(err => {
          console.error(err);
          return err.then(e => alert(e.msg || e.message || e.toString()));
        });
    };
</script>